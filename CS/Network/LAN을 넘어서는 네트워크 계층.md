# 📡 네트워크 계층과 IP 주소

## 데이터 링크 계층의 한계

1. **라우팅 불가능**
   
   - 물리/데이터 링크 계층만으로는 **라우팅 수행 불가**
   - 라우팅이란: 패킷이 이동할 **최적의 경로를 결정**하는 것

2. **MAC 주소의 범위 한계**
   
   - MAC 주소만으로는 모든 네트워크의 호스트를 특정하기 어려움
   - 모든 호스트가 서로의 MAC 주소를 알 수는 없음
   - → **IP 주소와 함께 사용되며**, 기본적으로는 IP 주소를 우선 사용

---

## MAC 주소 vs IP 주소

| 항목       | MAC 주소                      | IP 주소                                    |
| -------- | --------------------------- | ---------------------------------------- |
| 정의       | 네트워크 장비에 고유하게 부여된 하드웨어 주소   | 네트워크 상에서 장비의 논리적 위치를 나타내는 주소             |
| 계층       | 데이터 링크 계층 (2계층)             | 네트워크 계층 (3계층)                            |
| 형식       | 48비트 (예: 00:1A:2B:3C:4D:5E) | IPv4: 32비트 (예: 192.168.0.1), IPv6: 128비트 |
| 변경 가능 여부 | 일반적으로 고정 (NIC에 내장)          | 유동/고정 가능 (DHCP, 수동 설정 등)                 |
| 역할       | LAN 내부 장비 식별                | 네트워크 간 통신, 라우팅에 사용                       |
| 고유성      | 전 세계에서 유일                   | 네트워크 내에서 유일 (중복 가능)                      |
| 관리 주체    | 제조사 (OUI 기반)                | ISP 또는 네트워크 관리자                          |
| 사용 목적    | 근거리 통신                      | 인터넷 포함 넓은 경로 지정 및 통신                     |

✅ **공통점**

- 네트워크 장비를 식별하는 데 사용
- 패킷 전송 시 주소 지정에 필수

## 📦 두 가지 IP 주소 구분

| 구분           | 사설 IP 주소 (Private IP)                                                                           | 공인 IP 주소 (Public IP)                       |
| ------------ | ----------------------------------------------------------------------------------------------- | ------------------------------------------ |
| 용도           | **네트워크 내부** 식별용                                                                                 | **인터넷 상에서** 전 세계 식별용                       |
| 주소 범위        | - 192.168.0.0 ~ 192.168.255.255<br>- 10.0.0.0 ~ 10.255.255.255<br>- 172.16.0.0 ~ 172.31.255.255 | 전 세계에서 유일하게 배정받는 주소                        |
| 통신 범위        | 내부망 (LAN)                                                                                       | 외부망 (인터넷)                                  |
| 인터넷 접속 가능 여부 | ❌ 직접 연결 불가능                                                                                     | ✅ 직접 연결 가능                                 |
| IP 충돌 가능성    | 다른 네트워크와 **겹칠 수 있음**                                                                            | 절대 **겹치면 안 됨**                             |
| 예시           | 192.168.0.5, 10.0.0.3                                                                           | 8.8.8.8 (Google DNS), 1.1.1.1 (Cloudflare) |

---

## 🌐 인터넷 프로토콜 (IP)

- **네트워크 계층**의 핵심 프로토콜
- 기본적으로 **IPv4**를 의미

### IP 주소 형태

- `0 ~ 255` 범위의 **10진수 4개**
- 예: `192.168.0.1`
- 각 숫자는 8비트 → **옥텟(Octet)** 이라고 부름

---

## IP의 주요 기능

### 1. IP 주소 지정

- 송수신 대상 장비 식별

### 2. IP 단편화 (Fragmentation)

- 전송하려는 패킷이 **MTU(Maximum Transmission Unit)** 보다 클 경우  
  →  **MTU**이하로 나누어 전송
- MTU: 한 번에 전송 가능한 최대 패킷 크기

---

## IPv4 패킷 구조

| 필드                | 설명                                          |
| ----------------- | ------------------------------------------- |
| **식별자**           | 패킷을 식별하는 고유 번호 (단편화 시 원래 패킷과의 관계를 표시)       |
| **플래그**           | 단편화 허용 여부 (`DF`), 추가 단편 존재 여부 (`MF`) 등      |
| **단편화 오프셋**       | 단편화된 패킷이 원래 데이터에서 몇 번째에 해당하는지 표시            |
| **TTL**           | 패킷의 수명 (Hop 수) - 라우터 거칠 때마다 1씩 감소, 0이 되면 폐기 |
| **프로토콜**          | 상위 계층 프로토콜 정보 (예: TCP, UDP)                 |
| **출발지/목적지 IP 주소** | 송수신 IP 주소                                   |

---

## IPv6

- IPv4 주소 고갈 문제 해결을 위해 등장
- **콜론(:)** 으로 구분된 **16진수 8개 그룹**
- 사실상 무한에 가까운 주소 공간 제공

### IPv6 기본 헤더

| 필드             | 설명                     |
| -------------- | ---------------------- |
| **다음 헤더**      | 상위 계층 프로토콜 또는 확장 헤더 지시 |
| **홉 제한**       | IPv4의 TTL과 동일한 역할      |
| **출발지/목적지 IP** | 송수신 IP 주소 정보           |

✅ **IPv6는 고정 40바이트 헤더**  
→ 추가 정보는 **확장 헤더(Extension Header)** 로 분리  
→ IPv4는 가변 헤더

---

## ARP (Address Resolution Protocol)

- 같은 네트워크에 속한 **상대방의 MAC 주소를 알기 위해** 사용하는 프로토콜

### ARP 동작 과정

1. **ARP 요청**
   
   - 브로드캐스트로 네트워크 전체에 "이 IP 주소 가진 사람 누구야?"라고 물음

2. **ARP 응답**
   
   - 해당 IP를 가진 호스트가 자신의 **MAC 주소를 응답**

3. **ARP 테이블 갱신**
   
   - 응답 받은 IP-MAC 매핑을 **ARP 테이블**에 저장  
   - 일정 시간 지나면 삭제되며 갱신 가능

---

## IP 단편화를 피하는 방법

- 단편화는 **트래픽 증가와 대역폭 낭비**를 초래할 수 있음
- → 가능하면 피하는 것이 좋음

### 1. 경로 MTU (Path MTU)

- **라우터들을 포함한 경로에서 허용되는 최대 MTU**

### 2. 경로 MTU 발견 (PMTUD: Path MTU Discovery)

- 전송 크기를 점점 줄여가며 **DF(단편화 금지) 비트를 설정하고 시도**
- 오류 없이 수신되면 해당 크기가 경로 MTU임을 추정

---
